<!DOCTYPE html>
<html>

<head>
    <title>Admin Dashboard</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/styles.css">
</head>

<body>
    <div class="form-container" style="max-width: 1000px;">
        <a href="/admin/logout" class="logout-link">Logout</a>
        <div class="header">
            <h2>Registration Dashboard</h2>
        </div>

        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Mobile</th>
                        <th>Email</th>
                        <th>Company</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% users.forEach(u=> { %>
                        <tr id="row-<%= u.id %>">
                            <td data-label="Name"><strong>
                                    <%= u.name %>
                                </strong></td>
                            <td data-label="Mobile">
                                <%= u.mobile %>
                            </td>
                            <td data-label="Email">
                                <%= u.email %>
                            </td>
                            <td data-label="Company">
                                <%= u.companyName %>
                            </td>
                            <td data-label="Action">
                                <% if (u.isGifted) { %>
                                    <button class="btn-status btn-gifted" disabled>Gifted</button>
                                    <% } else { %>
                                        <form method="POST" action="/admin/gift" style="width: 100%;"
                                            onsubmit="return giftLoading(this)">

                                            <input type="hidden" name="docId" value="<%= u.id %>">

                                            <button type="submit" class="btn-status">
                                                <span class="gift-text">Mark Gifted</span>
                                                <span class="spinner hidden"></span>
                                            </button>
                                        </form>

                                        <% } %>
                            </td>
                        </tr>
                        <% }) %>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        function giftLoading(form) {
            const btn = form.querySelector("button");
            const text = btn.querySelector(".gift-text");
            const spinner = btn.querySelector(".spinner");

            text.style.display = "none";
            spinner.classList.remove("hidden");
            btn.disabled = true;

            localStorage.setItem("scrollY", window.scrollY);
            return true; // allow submit
        }

        window.onload = () => {
            const y = localStorage.getItem("scrollY");
            if (y) {
                window.scrollTo(0, parseInt(y));
                localStorage.removeItem("scrollY");
            }
        };
    </script>


</body>

</html>